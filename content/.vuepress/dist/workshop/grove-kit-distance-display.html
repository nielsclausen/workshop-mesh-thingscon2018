<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Measuring &amp; Displaying a distance | IoT Workshop – Particle Mesh</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.29dd6f97.css" as="style"><link rel="preload" href="/assets/js/app.ec553603.js" as="script"><link rel="preload" href="/assets/js/2.1cb01dab.js" as="script"><link rel="preload" href="/assets/js/4.f1c611d8.js" as="script"><link rel="prefetch" href="/assets/js/10.e68b8f42.js"><link rel="prefetch" href="/assets/js/11.3fd61ceb.js"><link rel="prefetch" href="/assets/js/12.55d4d5f0.js"><link rel="prefetch" href="/assets/js/13.bd75949b.js"><link rel="prefetch" href="/assets/js/3.8620b7cc.js"><link rel="prefetch" href="/assets/js/5.4b53524e.js"><link rel="prefetch" href="/assets/js/6.88e54c06.js"><link rel="prefetch" href="/assets/js/7.71a5887f.js"><link rel="prefetch" href="/assets/js/8.53f67123.js"><link rel="prefetch" href="/assets/js/9.391c0077.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29dd6f97.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IoT Workshop – Particle Mesh</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.reflektor.dk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reflektor
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Particle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/nielsclausen/workshop-mesh-thingscon2018" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.reflektor.dk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reflektor
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Particle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/nielsclausen/workshop-mesh-thingscon2018" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workshop/" class="sidebar-link">Introduction</a></li><li><a href="/workshop/prerequisites.html" class="sidebar-link">Preparations</a></li><li><a href="/workshop/box-to-blinky.html" class="sidebar-link">1 – From Box to Blinky</a></li><li><a href="/workshop/grove-kit-distance-display.html" class="active sidebar-link">2 – Measuring a distance</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/workshop/grove-kit-distance-display.html#unboxing-the-grove-kit" class="sidebar-link">Unboxing the Grove Kit</a></li><li class="sidebar-sub-header"><a href="/workshop/grove-kit-distance-display.html#measuring-distance-with-the-ultrasonic-ranger" class="sidebar-link">Measuring distance with the Ultrasonic Ranger</a></li><li class="sidebar-sub-header"><a href="/workshop/grove-kit-distance-display.html#using-the-4-digit-display" class="sidebar-link">Using the 4-Digit Display</a></li></ul></li><li><a href="/workshop/mesh-messaging.html" class="sidebar-link">3 – Working in the Mesh</a></li><li><a href="/workshop/mesh-distance-display.html" class="sidebar-link">4 – Putting it all together</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="working-with-grove-sensors"><a href="#working-with-grove-sensors" aria-hidden="true" class="header-anchor">#</a> Working with Grove Sensors</h1> <div class="sbox-container" data-v-24264f9a><div class="sbox-table" data-v-24264f9a><div class="sbox-row" data-v-24264f9a><div class="sbox-header" data-v-24264f9a>Goal </div> <div class="sbox-content" data-v-24264f9a>Measure a distance and show it on a digital display.</div></div> <div class="sbox-row" data-v-24264f9a><div class="sbox-header" data-v-24264f9a> Time </div> <div class="sbox-content" data-v-24264f9a> 20 min </div></div> <div class="sbox-row" data-v-24264f9a><div class="sbox-header" data-v-24264f9a> Tools </div> <div class="sbox-content" data-v-24264f9a><ul data-v-24264f9a><li data-v-24264f9a>Argon</li><li data-v-24264f9a>Grove starter kit for Particle Mesh</li><li data-v-24264f9a>The Particle Web IDE and CLI</li></ul></div></div></div></div> <p>In this session, you'll use your Particle Argon and the Grove starter kit to set up a distance sensor and a digital display to show the measured distance. If you run into any issues while working on this lab, click <a href="https://go.particle.io/shared_apps/5bfdb67ea5185c2b7700072a" target="_blank" rel="noopener noreferrer">here to access the completed source code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="tip custom-block"><p class="custom-block-title">Do you come prepared?</p> <p>It is assumed that you come to this session with an Argon that you are able to program.</p></div> <h2 id="unboxing-the-grove-kit"><a href="#unboxing-the-grove-kit" aria-hidden="true" class="header-anchor">#</a> Unboxing the Grove Kit</h2> <p>The Grove starter kit for Particle Mesh comes with seven different components that work out-of-the-box with Particle Mesh devices, and a Grove Shield that allows you to plug in your Feather-compatible Mesh devices for quick prototyping. The shield houses 8 Grove ports that support all types of Grove accessories. For more information about the kit, <a href="https://docs.particle.io/datasheets/accessories/mesh-accessories/#grove-starter-kit-for-particle-mesh" target="_blank" rel="noopener noreferrer">click here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>For this lab, you'll need the following items from the kit:</p> <ul><li>Grove Shield</li> <li>Ultrasonic Ranger</li> <li>4-Digit Display</li></ul> <ol><li>Open the Grove Starter Kit and remove the three components listed above, as well as the bag of Grove connectors.</li></ol> <p><img src="/assets/img/02-grovecomponents.1b5e9e4e.png" alt></p> <ol start="2"><li>Remove the Grove Shield and plug in your Argon. This should be the same device you claimed in the last lab.</li></ol> <p><img src="/assets/img/03-argoninshield.d81d7eb0.png" alt></p> <p>Now, you're ready to start using your first Grove component!.</p> <h2 id="measuring-distance-with-the-ultrasonic-ranger"><a href="#measuring-distance-with-the-ultrasonic-ranger" aria-hidden="true" class="header-anchor">#</a> Measuring distance with the Ultrasonic Ranger</h2> <p>First, we'll connect the included Ultrasonic Ranger, collect distance readings from the device and write those readings to the serial console.</p> <ol><li>Open the bag containing the Ultrasonic Ranger and take one Grove connector out of the connector bag.</li></ol> <p><img src="/assets/img/05-ultrasonicsensor.3c09a1be.png" alt></p> <ol start="2"><li>Connect one end of the Grove connector to the bottom of the Ultrasonic Ranger.</li></ol> <p><img src="/assets/img/06-sensorswithplug.1bc1fd92.png" alt></p> <ol start="3"><li>Plug the other end of the connector into the Shield port labeled <code>D2</code>.</li></ol> <p><img src="/assets/img/07-d2connector.85ae12c3.png" alt></p> <ol start="4"><li>To program our devices, we're going to use the Particle Web IDE, which you can access at <a href="https://build.particle.io" target="_blank" rel="noopener noreferrer">build.particle.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Log-in to your account and create a new app with a name of your choosing.</li></ol> <p><img src="/assets/img/08-apptitle.e21ce43f.png" alt></p> <ol start="5"><li>To use the Ultrasonic Ranger, we'll need the help of a <a href="https://build.particle.io/libs/Grove_Ultrasonic_Ranger/1.0.0/tab/Ultrasonic.cpp" target="_blank" rel="noopener noreferrer">library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which you can include in your project by clicking on the libraries tab in the lower left side of the screen.</li></ol> <p><img src="/assets/img/09-librariestab.1a3b68ae.png" alt></p> <ol start="6"><li>Type &quot;Grove&quot; in the search box and click on the <code>Grove-Ultrasonic-Ranger</code> library in the results.</li></ol> <p><img src="/assets/img/10-librariessearch.ef9b91b6.png" alt></p> <ol start="7"><li>Click on the &quot;Include in Project&quot; button.</li></ol> <p><img src="/assets/img/11-librariesinclude.a4643905.png" alt></p> <ol start="8"><li>Select the project you set-up in Step #4 and click &quot;Confirm&quot;.</li></ol> <p><img src="/assets/img/12-includeconfirm.27a9a16e.png" alt></p> <ol start="9"><li>To start using the library, we'll first need to add an include statement. Add the following to the top of your project file, replacing the <code>#include</code> statement that was added when you imported the library.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;Ultrasonic.h&quot;</span></span>
</code></pre></div><ol start="10"><li>Then, on the next line, let's configure the ranger with the GPIO pin we plugged the Grove connector into, <code>D2</code></li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code>Ultrasonic <span class="token function">ultrasonic</span><span class="token punctuation">(</span>D2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="11"><li>Next, in the <code>setup</code> function, start the <code>Serial</code> monitor so we can emit readings.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">9600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="12"><li>Finally, in the <code>loop</code> function, calculate the range using the <code>measureInCentimeters</code> method (<code>measureInInches</code> is also supported), which returns a value between <code>0</code> and <code>400</code>. We'll also include a delay to keep the console scroll factor reasonable.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> range<span class="token punctuation">;</span>

	Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Obstacle found at:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	range <span class="token operator">=</span> ultrasonic<span class="token punctuation">.</span><span class="token function">MeasureInCentimeters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0~400cm</span>
	Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; cm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="13"><li>Before flashing your device, open a terminal window and enter the following command. This requires the <a href="https://www.npmjs.com/package/particle-cli" target="_blank" rel="noopener noreferrer">Particle CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which you can install with the command <code>npm install -g particle-cli</code> if you haven't already.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>particle serial monitor --follow
</code></pre></div><ol start="14"><li>Now, you can flash the code to your device. First, click on the target icon to open the Devices tab.</li></ol> <p><img src="/assets/img/14-devices.1b1bb309.png" alt></p> <ol start="15"><li>Select your Argon by clicking the star icon next to the name.</li></ol> <p><img src="/assets/img/15-device.763c695e.png" alt></p> <ol start="16"><li>Click the lightning bolt icon to flash your device.</li></ol> <p><img src="/assets/img/16-flash.7c574250.png" alt></p> <ol start="17"><li>The device will update and flash magenta before restarting and breathing cyan again. Once it does, you should see values pop up in your serial terminal window. Try moving your hand in front of the ranger to see what happens.</li></ol> <p><img src="/assets/img/17-serial.36753dbe.gif" alt></p> <h2 id="using-the-4-digit-display"><a href="#using-the-4-digit-display" aria-hidden="true" class="header-anchor">#</a> Using the 4-Digit Display</h2> <p>Next, let's connect the 4-Digit Display and modify our code to display distance measurements from the Ultrasonic Ranger.</p> <ol><li>Open the bag containing the 4-Digit Display and take one Grove connector out of the connector bag.</li></ol> <p><img src="/assets/img/18-display.7ed18749.png" alt></p> <ol start="2"><li>Connect one end of the Grove connector to the display.</li></ol> <p><img src="/assets/img/19-connector.e9f7b1ab.png" alt></p> <ol start="3"><li>Plug the other end of the connector into the Shield port labeled <code>D4</code>.</li></ol> <p><img src="/assets/img/20-connected.a676481a.png" alt></p> <ol start="4"><li>As with the Ultrasonic Ranger, the 4-Digit Display uses a library. Open the libraries tab, search for <code>Grove</code> and click the <code>Grove_4Digit_Display</code> entry.</li></ol> <p><img src="/assets/img/21-displaylibrary.22843b5b.png" alt></p> <ol start="5"><li>Click &quot;Include in Project&quot;, select your project and click &quot;Confirm&quot;.</li></ol> <p><img src="/assets/img/22-displayconfirm.a8288cba.png" alt></p> <ol start="6"><li>Remove the auto-included text and add an include for the display library, just after the include for the Ultrasonic Ranger.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;TM1637.h&quot;</span></span>
</code></pre></div><ol start="7"><li>The display library uses two digital pins for timing (<code>CLK</code>) and data (<code>DIO</code>), and we can create a few <code>define</code> statements to alias the <code>D4</code> and <code>D5</code> pins on the Shield and Argon. Add the following after your <code>include</code> statements:</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> CLK D4</span>
<span class="token macro property">#<span class="token directive keyword">define</span> DIO D5</span>
</code></pre></div><ol start="8"><li>Using those aliases, we can now create a new display class instance, just after the <code>Ultrasonic</code> class.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code>TM1637 <span class="token function">disp</span><span class="token punctuation">(</span>CLK<span class="token punctuation">,</span>DIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="9"><li>To use the display, we'll first need to initialize it. Add the following lines to the <code>setup</code> function:</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code>disp<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Options are: BRIGHT_TYPICAL = 2,BRIGHT_DARKEST = 0,BRIGHTEST = 7;</span>
disp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>BRIGHT_TYPICAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="10"><li>With the display set-up, we can use it to show the current reading from our Ultrasonic Ranger. First, we'll need a global variable to hold the last range reading, which you can add before the <code>setup</code> function.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> lastRange <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><ol start="11"><li>Next, in the <code>loop</code> function, we can start by adding a few variables to hold state information we'll need later. Add these right after the <code>range</code> variable:</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> digit<span class="token punctuation">;</span>
<span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><ol start="11"><li>Then, after the <code>range</code> reading, add the following code to display the reading on the display:</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>range <span class="token operator">!=</span> lastRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	lastRange <span class="token operator">=</span> range<span class="token punctuation">;</span>

	<span class="token comment">// Fill display with zeros</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		disp<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Extract each digit from the range and write it to the display</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>range <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Get the current digit by performing modulo (%) division on the range</span>
		digit  <span class="token operator">=</span> range <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
		<span class="token comment">// Remove the trailing digit by whole-number division</span>
		range <span class="token operator">/</span><span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

		disp<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> digit<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pos<span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The if statement checks to see if the current reading differs from the last. If they are the same, we don't need to update the display. If they differ, however, we'll fill the display with zeros.</p> <p>The rest of the code is dedicated to extracting each digit from the <code>range</code> variable and writing that digit to the display. One way to accomplish this is to use modulo division by 10 to get the trailing character from a number (i.e. <code>43 % 10 = 3</code>), and then whole number division by ten to remove the trailing character (i.e. <code>43 / 10 = 4</code>). Then, we can display the trailing character and repeat the process until there are no characters left.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>The 4-Digit Display is actually four, discrete seven-segment displays chained together. Each call to <code>display</code> expects a character position to write to (0, 1, 2 or 3) and a number between 0 and 15 that represents the digits 0-9 and characters A, b, C, d, E and F.</p></div> <ol start="12"><li>Once you've added the code above, you can flash your Argon. After it comes back online, you should see readings on the display!</li></ol> <p><img src="/assets/img/23-display.929d8527.gif" alt></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workshop/box-to-blinky.html" class="prev">
          1 – From Box to Blinky
        </a></span> <span class="next"><a href="/workshop/mesh-messaging.html">
          3 – Working in the Mesh
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/2.1cb01dab.js" defer></script><script src="/assets/js/4.f1c611d8.js" defer></script><script src="/assets/js/app.ec553603.js" defer></script>
  </body>
</html>
